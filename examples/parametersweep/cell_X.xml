<Lems>

<ComponentType name="cellX"
    extends="baseCellMembPotCap"
    description="...">
    
    <Parameter name="bias" dimension="none" description="..."/>
    <Parameter name="gain" dimension="none" description="..."/>
    <!--<Parameter name="tau" dimension="time"/>-->

    <!--
    Defined in baseCellMembPotCap:
    <Parameter name="C" dimension="capacitance"/>
    -->

    <!-- Initial Conditions -->
    <Parameter name="state0" dimension="none"/>

    <Attachments name="synapses" type="basePointCurrent"/>

    <Constant name="MVOLT" dimension="voltage" value="1mV"/>
    <Constant name="PAMP" dimension="current" value="1pA"/>

    <!-- <Exposure name="v" dimension="none"/> --> <!-- Already exposed from baseCellMembPotDL -->
    <Exposure name="iSyn" dimension="current"/>
    <Exposure name="spiking" dimension="none"/>
    <Exposure name="state" dimension="none"/>
    <Exposure name="output" dimension="none"/>
    
    <Dynamics>
        
        <StateVariable name="v" dimension="voltage" exposure="v" description="Membrane potential state variable"/>
        <StateVariable name="spiking" dimension="none" exposure="spiking"/>
        <!--<StateVariable name="state" dimension="none" exposure="state"/>-->
        
        <DerivedVariable name="iSyn" dimension="current" exposure="iSyn" select="synapses[*]/i" reduce="add" />
        <DerivedVariable name="state" dimension="none" exposure="state" value="v/MVOLT" />
        <DerivedVariable name="output" dimension="none" exposure="output" value="1/(1 + exp(-1 * gain * (state+bias)))" />


        <DerivedVariable name="iMemb" dimension="current" exposure="iMemb" value="((0-state)*PAMP + iSyn)"/>

        <TimeDerivative variable="v" value="iMemb / C"/>
        
        <OnStart>
            <StateAssignment variable="v" value="state0*MVOLT"/>
        </OnStart>

        <OnCondition test="v .gt. 0 .and. spiking .lt. 0.5">
            <StateAssignment variable="spiking" value="1"/>
            <EventOut port="spike"/>
        </OnCondition>

        <OnCondition test="v .lt. 0">
            <StateAssignment variable="spiking" value="0"/>
        </OnCondition>
    

    </Dynamics>
    
</ComponentType>

<cellX id="GenericNeuronCellX" C="100 pF" bias="1" gain="1" state0=".5"/>

</Lems>
    
